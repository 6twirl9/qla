/**************** QLA_F3_D_vpeq_sprecon_M_times_pH.c ********************/

#include <qla_types.h>
#include <qla_random.h>
#include <qla_cmath.h>
#include <math.h>

void QLA_F3_D_vpeq_sprecon_M_times_pH ( QLA_F3_DiracFermion *__restrict__ r , QLA_F3_ColorMatrix  *a , QLA_F3_HalfFermion  **b , int mu, int sign , int n )
{
  int i;
  for(i=0;i<n;i++)
    {
      QLA_F3_HalfFermion t;
      QLA_F3_DiracFermion *ri = &r[i];
      QLA_F3_ColorMatrix *ai = &a[i];
      {
        int i_c;
        for(i_c=0;i_c<3;i_c++)
          {
            int i_s;
            for(i_s=0;i_s<2;i_s++)
              {
                int k_c;
                QLA_F_Complex *x;
                x = &QLA_F3_elem_H(t,i_c,i_s);
                QLA_c_eq_r(*x,0.)
                for(k_c=0;k_c<3;k_c++)
                  {
                    QLA_c_peq_c_times_c(*x,QLA_F3_elem_M(*ai,i_c,k_c),QLA_F3_elem_H(*b[i],k_c,i_s))
                  }
              }
          }
      }
      {
        int i_c;
        if(sign==1){
          switch(mu){
          case 0:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_ic(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_ic(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,0))
              }
            break;
          case 1:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_c(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,0))
              }
            break;
          case 2:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_ic(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_ic(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,1))
              }
            break;
          case 3:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,1))
              }
            break;
          }
        }
        else{
          switch(mu){
          case 0:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_ic(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_ic(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,0))
              }
            break;
          case 1:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_c(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,0))
              }
            break;
          case 2:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_peq_ic(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,0))
                QLA_c_meq_ic(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,1))
              }
            break;
          case 3:
            for(i_c=0;i_c<3;i_c++)
              {
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,0),QLA_F3_elem_H(t,i_c,0))
                QLA_c_peq_c(QLA_F3_elem_D(*ri,i_c,1),QLA_F3_elem_H(t,i_c,1))
                QLA_c_meq_c(QLA_F3_elem_D(*ri,i_c,2),QLA_F3_elem_H(t,i_c,0))
                QLA_c_meq_c(QLA_F3_elem_D(*ri,i_c,3),QLA_F3_elem_H(t,i_c,1))
              }
            break;
          }
        }
      }
    }
}
